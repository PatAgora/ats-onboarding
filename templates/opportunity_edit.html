{% extends "base.html" %}
{% set hide_topbar = True %}
{% block title %}Edit Opportunity · {{ opp.name }}{% endblock %}

{% block content %}
<style>
  /* Modern Card Styles */
  .modern-card {
    border-radius: 16px;
    border: none;
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    transition: box-shadow 0.3s ease;
    background: white;
  }
  
  .modern-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  }
  
  /* Page Header */
  .page-header-section {
    background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
    border-radius: 16px;
    padding: 2rem;
    color: white;
    margin-bottom: 2rem;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
  }
  
  .page-header-section h1 {
    color: white;
    margin-bottom: 0.5rem;
    font-size: 2rem;
    font-weight: 700;
  }
  
  .page-header-section .subtitle {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1rem;
    margin-bottom: 0;
  }
  
  /* Form Labels */
  .form-label-modern {
    font-weight: 600;
    color: #374151;
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.025em;
  }
  
  .form-label-modern i {
    color: #3b82f6;
    margin-right: 0.375rem;
  }
  
  /* Form Controls */
  .form-control-modern,
  .form-select-modern {
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    padding: 0.625rem 0.875rem;
    font-size: 0.9375rem;
    transition: all 0.2s ease;
    background: white;
  }
  
  .form-control-modern:focus,
  .form-select-modern:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    outline: none;
  }
  
  .form-control-modern::placeholder {
    color: #9ca3af;
  }
  
  /* Buttons */
  .btn-modern {
    border-radius: 8px;
    padding: 0.625rem 1.25rem;
    font-weight: 600;
    transition: all 0.2s ease;
    border: none;
    font-size: 0.9375rem;
  }
  
  .btn-modern-primary {
    background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
    color: white;
  }
  
  .btn-modern-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    color: white;
  }
  
  .btn-modern-outline {
    background: white;
    border: 2px solid #e5e7eb;
    color: #374151;
  }
  
  .btn-modern-outline:hover {
    border-color: #3b82f6;
    color: #3b82f6;
    background: #f9fafb;
  }
  
  /* Form Section Headers */
  .form-section-header {
    font-size: 1rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #f3f4f6;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .form-section-header i {
    color: #3b82f6;
  }
  
  /* Animation */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .fade-in-up {
    animation: fadeInUp 0.5s ease forwards;
  }
  
  .stagger-1 { animation-delay: 0.1s; opacity: 0; }
  .stagger-2 { animation-delay: 0.2s; opacity: 0; }
  
  /* Responsive */
  @media (max-width: 768px) {
    .page-header-section {
      padding: 1.5rem;
    }
    
    .page-header-section h1 {
      font-size: 1.5rem;
    }
  }
</style>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="container-xxl px-4 pt-3 pb-4">
  <!-- Enhanced Header -->
  <div class="page-header-section fade-in-up stagger-1">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
      <div>
        <h1>
          <i class="fas fa-edit"></i>
          Edit Opportunity
        </h1>
        <p class="subtitle mb-0">{{ opp.name }}</p>
      </div>
      <a class="btn btn-modern-outline" href="{{ url_for('opportunities_') }}">
        <i class="fas fa-arrow-left"></i> Back to Opportunities
      </a>
    </div>
  </div>

  <!-- Form Card -->
  <div class="modern-card fade-in-up stagger-2">
    <div class="card-body p-4">
      <form method="post">
        {{ form.csrf_token }}
        
        <!-- Core Details Section -->
        <div class="form-section-header">
          <i class="fas fa-info-circle"></i>
          Core Details
        </div>
        
        <div class="row g-3 mb-4">
          <div class="col-md-6">
            <label class="form-label-modern">
              <i class="fas fa-tag"></i>
              {{ form.name.label.text }}
            </label>
            {{ form.name(class="form-control-modern") }}
          </div>

          <div class="col-md-6">
            <label class="form-label-modern">
              <i class="fas fa-building"></i>
              {{ form.client.label.text }}
            </label>
            {{ form.client(class="form-control-modern") }}
          </div>

          <div class="col-md-6">
            <label class="form-label-modern">
              <i class="fas fa-chart-line"></i>
              {{ form.stage.label.text }}
            </label>
            {{ form.stage(class="form-select-modern form-select") }}
          </div>

          <div class="col-md-6">
            <label class="form-label-modern">
              <i class="fas fa-user"></i>
              {{ form.owner.label.text }}
            </label>
            {{ form.owner(class="form-control-modern") }}
          </div>
        </div>

        <!-- Financial & Timeline Section -->
        <div class="form-section-header">
          <i class="fas fa-calculator"></i>
          Financial & Timeline Estimates
        </div>
        
        <div class="row g-3 mb-4">
          <div class="col-md-4">
            <label class="form-label-modern">
              <i class="fas fa-calendar-alt"></i>
              {{ form.est_start.label.text }}
            </label>
            {{ form.est_start(class="form-control-modern", placeholder="DD/MM/YYYY") }}
            <div class="form-text small mt-1 ms-1">
              <i class="fas fa-info-circle me-1"></i>
              Expected start date in UK format
            </div>
          </div>

          <div class="col-md-4">
            <label class="form-label-modern">
              <i class="fas fa-sterling-sign"></i>
              {{ form.est_value.label.text }}
            </label>
            {{ form.est_value(class="form-control-modern", placeholder="e.g., 50000") }}
            <div class="form-text small mt-1 ms-1">
              <i class="fas fa-info-circle me-1"></i>
              Estimated value in GBP
            </div>
          </div>

          {% if form.probability is defined %}
          <div class="col-md-4">
            <label class="form-label-modern">
              <i class="fas fa-percent"></i>
              {{ form.probability.label.text }}
            </label>
            {{ form.probability(class="form-control-modern", placeholder="0–100") }}
            <div class="form-text small mt-1 ms-1">
              <i class="fas fa-info-circle me-1"></i>
              Likelihood of winning (0-100%)
            </div>
          </div>
          {% endif %}
        </div>

        <!-- Notes Section -->
        <div class="form-section-header">
          <i class="fas fa-sticky-note"></i>
          Additional Information
        </div>
        
        <div class="row g-3 mb-4">
          <div class="col-12">
            <label class="form-label-modern">
              <i class="fas fa-align-left"></i>
              {{ form.notes.label.text }}
            </label>
            {{ form.notes(class="form-control-modern", rows="4", placeholder="Add any relevant notes or details about this opportunity...") }}
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="d-flex gap-2 pt-3 border-top">
          <button class="btn btn-modern btn-modern-primary" type="submit">
            <i class="fas fa-save me-2"></i>Save Changes
          </button>
          <a class="btn btn-modern btn-modern-outline" href="{{ url_for('opportunities_') }}">
            <i class="fas fa-times me-2"></i>Cancel
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
